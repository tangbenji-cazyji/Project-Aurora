<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="energy_title">TASMAN LOGIC // CONFIG</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
</head>

<body class="bg-slate-950 text-slate-200 font-sans selection:bg-yellow-500/30 overflow-hidden">
    <div
        class="fixed inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-black pointer-events-none">
    </div>

    <main class="relative z-10 p-8 max-w-6xl mx-auto h-screen flex flex-col">
        <header class="flex justify-between items-center border-b border-white/5 pb-6 mb-8">
            <h1 class="text-2xl font-black text-yellow-500 tracking-tighter uppercase" data-i18n="energy">TASMAN LOGIC
                // ENERGY</h1>
            <p class="text-[10px] text-slate-500 font-technical uppercase" data-i18n="asset_gov">// ASSET & THERMAL
                GOVERNANCE</p>
            </div>
            <div class="flex gap-4 items-center">
                <a href="./index.html"
                    class="px-4 py-2 border border-white/10 rounded text-[10px] hover:bg-slate-800 transition-colors uppercase font-bold tracking-widest text-slate-400"
                    data-i18n="back_to_hud">Back
                    to HUD</a>
                <button id="save-btn"
                    class="px-8 py-2 bg-yellow-600/20 border border-yellow-500/50 rounded text-[10px] hover:bg-yellow-500 hover:text-white transition-all uppercase font-black tracking-[0.2em] text-yellow-500 shadow-[0_0_15px_rgba(234,179,8,0.1)]"
                    data-i18n="save_btn">SAVE CHANGES</button>
            </div>
        </header>

        <div class="flex-1 grid grid-cols-2 gap-12 overflow-hidden">
            <!-- Left Column: Midea Hardware -->
            <section class="space-y-6 overflow-y-auto pr-4 border-r border-white/5 flex flex-col">
                <div class="space-y-1">
                    <h2 class="text-xs font-bold text-yellow-500 uppercase tracking-[0.2em]" data-i18n="hardware_specs">
                        HARDWARE SPECS</h2>
                    <p class="text-[10px] text-slate-600 uppercase italic font-technical" data-i18n="equipment_desc">//
                        MIDEA VILLA EQUIPMENT</p>
                </div>

                <div class="space-y-4">
                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest"
                        data-i18n="product_tier">Product Tier</label>
                    <div class="grid grid-cols-2 gap-3">
                        <button
                            class="tier-btn p-4 border border-slate-800 rounded glass-card hover:border-yellow-500 transition-all text-center"
                            data-tier="ARCTIC_12">
                            <p class="text-xs font-black text-slate-400">ARCTIC 12 HP</p>
                            <p class="text-[8px] text-slate-600 uppercase font-technical">8kW INV // 190L</p>
                        </button>
                        <button
                            class="tier-btn p-4 border border-slate-800 rounded glass-card hover:border-yellow-500 transition-all text-center"
                            data-tier="ARCTIC_14">
                            <p class="text-xs font-black text-slate-400">ARCTIC 14 HP</p>
                            <p class="text-[8px] text-slate-600 uppercase font-technical">10kW INV // 240L</p>
                        </button>
                    </div>
                </div>

                <!-- Tier Tech Specs Box -->
                <div class="p-4 glass-panel rounded grid grid-cols-2 gap-y-4 gap-x-6 border-white/5">
                    <div class="space-y-1">
                        <p class="text-[8px] text-slate-600 uppercase tracking-widest" data-i18n="inverter_spec">
                            Inverter</p>
                        <p id="spec-inverter" class="text-xs font-technical text-slate-300">--</p>
                    </div>
                    <div class="space-y-1">
                        <p class="text-[8px] text-slate-600 uppercase tracking-widest" data-i18n="pv_spec">PV Capacity
                        </p>
                        <p id="spec-pv" class="text-xs font-technical text-slate-300">--</p>
                    </div>
                    <div class="space-y-1">
                        <p class="text-[8px] text-slate-600 uppercase tracking-widest" data-i18n="hp_spec">Heat Pump</p>
                        <p id="spec-hp" class="text-xs font-technical text-slate-300">--</p>
                    </div>
                    <div class="space-y-1">
                        <p class="text-[8px] text-slate-600 uppercase tracking-widest" data-i18n="batt_default">Default
                            Storage</p>
                        <p id="spec-batt" class="text-xs font-technical text-slate-300">--</p>
                    </div>
                </div>

                <div class="space-y-6 pt-4">
                    <div class="flex justify-between items-center">
                        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest"
                            data-i18n="battery_stack">H1 Battery Stack</label>
                        <span id="module-val" class="text-xl font-technical text-yellow-400">3</span>
                    </div>
                    <input type="range" id="module-slider" min="1" max="6" step="1" value="3"
                        class="w-full h-1 bg-white/5 rounded-lg appearance-none cursor-pointer accent-yellow-500 border border-white/5">

                    <div class="p-4 glass-card rounded flex justify-between items-center border-yellow-500/10">
                        <span class="text-[9px] text-yellow-600 uppercase tracking-widest"
                            data-i18n="total_capacity">Total Capacity</span>
                        <span id="capacity-val" class="text-lg font-technical text-yellow-500">15.4 kWh</span>
                    </div>

                    <div class="pt-4 border-t border-white/5 space-y-6">
                        <div class="flex justify-between items-center">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest"
                                data-i18n="dhw_tank">Hot Water Tank</label>
                            <span id="tank-val" class="text-xl font-technical text-orange-400">200L</span>
                        </div>
                        <input type="range" id="tank-slider" min="100" max="500" step="50" value="200"
                            class="w-full h-1 bg-white/5 rounded-lg appearance-none cursor-pointer accent-orange-500 border border-white/5">

                        <div class="flex justify-between items-center">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest"
                                data-i18n="dhw_target">Target Temp</label>
                            <span id="dhw-target-val" class="text-xl font-technical text-orange-400">55°C</span>
                        </div>
                        <input type="range" id="dhw-target-slider" min="40" max="75" step="1" value="55"
                            class="w-full h-1 bg-white/5 rounded-lg appearance-none cursor-pointer accent-orange-500 border border-white/5">
                    </div>
                </div>
            </section>

            <!-- Right Column: House Thermal Templates -->
            <section class="space-y-8 overflow-y-auto pl-4">
                <div class="space-y-2">
                    <h2 class="text-xs font-bold text-cyan-500 uppercase tracking-[0.2em]" data-i18n="thermal_specs">
                        THERMAL SPECS</h2>
                    <p class="text-[10px] text-slate-600 uppercase italic font-technical"
                        data-i18n="building_templates">// TASMANIAN BUILDING
                        TEMPLATES</p>
                </div>

                <div class="space-y-4">
                    <div class="grid grid-cols-1 gap-2">
                        <button
                            class="thermal-btn w-full p-4 border border-white/5 rounded glass-card hover:border-cyan-500 transition-all flex justify-between items-center"
                            data-type="WEATHERBOARD" data-val="1.80">
                            <div class="text-left">
                                <p class="text-xs font-bold uppercase" data-i18n="weatherboard">Weatherboard (Heritage)
                                </p>
                                <p class="text-[8px] text-slate-600 uppercase tracking-widest font-technical"
                                    data-i18n="old_hobart_desc">Typical
                                    Old Hobart Home // High Leakage</p>
                            </div>
                            <span class="text-sm font-technical text-slate-400">1.80</span>
                        </button>
                        <button
                            class="thermal-btn w-full p-4 border border-white/5 rounded glass-card hover:border-cyan-500 transition-all flex justify-between items-center"
                            data-type="BRICK_VENEER" data-val="1.20">
                            <div class="text-left">
                                <p class="text-xs font-bold uppercase" data-i18n="brick_veneer">Brick Veneer (Standard)
                                </p>
                                <p class="text-[8px] text-slate-600 uppercase tracking-widest font-technical"
                                    data-i18n="contemp_build_desc">
                                    Contemporary Build // Medium Leakage</p>
                            </div>
                            <span class="text-sm font-technical text-slate-400">1.20</span>
                        </button>
                        <button
                            class="thermal-btn w-full p-4 border border-white/5 rounded glass-card hover:border-cyan-500 transition-all flex justify-between items-center"
                            data-type="MODERN" data-val="0.60">
                            <div class="text-left">
                                <p class="text-xs font-bold uppercase" data-i18n="modern_insulated">Modern Insulated</p>
                                <p class="text-[8px] text-slate-600 uppercase tracking-widest font-technical"
                                    data-i18n="modern_design_desc">Double
                                    Glazing // Passive Design</p>
                            </div>
                            <span class="text-sm font-technical text-slate-400">0.60</span>
                        </button>

                        <div class="pt-4 h-px bg-white/5"></div>

                        <button
                            class="thermal-btn w-full p-4 border border-cyan-500/30 rounded glass-panel hover:border-cyan-500 transition-all flex justify-between items-center group relative overflow-hidden"
                            data-type="AI_FINGERPRINT">
                            <div class="absolute inset-0 bg-cyan-500/5 group-hover:bg-cyan-500/10 transition-colors">
                            </div>
                            <div class="text-left relative z-10">
                                <p class="text-xs font-bold text-cyan-400 uppercase flex items-center gap-2">
                                    <span
                                        class="w-1.5 h-1.5 bg-cyan-400 rounded-full animate-pulse shadow-[0_0_8px_rgba(34,211,238,0.5)]"></span>
                                    <span data-i18n="ai_fingerprint">AI Shadow Fingerprint</span>
                                </p>
                                <p class="text-[8px] text-cyan-700 uppercase tracking-widest font-technical"
                                    data-i18n="learning_cycle">Continuous
                                    Learning Cycle active</p>
                            </div>
                            <span id="fingerprint-display"
                                class="text-sm font-technical text-cyan-400 relative z-10">0.82</span>
                        </button>
                    </div>
                </div>

                <div class="p-4 glass-panel rounded-lg border-white/5 space-y-3">
                    <div class="flex items-center gap-2">
                        <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest"
                            data-i18n="clerk_label">Thermal Clerk</h3>
                        <span class="w-1 h-1 bg-cyan-500 rounded-full shadow-[0_0_8px_rgba(34,211,238,0.6)]"></span>
                        <span class="text-[8px] text-cyan-600 uppercase tracking-tighter animate-pulse"
                            data-i18n="analyzing">Analyzing...</span>
                    </div>
                    <p class="text-[10px] text-slate-500 leading-relaxed font-serif italic" data-i18n="clerk_note">
                        "The system is identifying thermal characteristics. The fingerprint represents physical inertia
                        learned over the last 720h."
                    </p>
                </div>
            </section>
        </div>

        <footer class="mt-auto pt-8 border-t border-white/5 text-[9px] text-slate-600 flex justify-between uppercase">
            <span id="status-text" class="font-technical tracking-widest" data-i18n="syncing_hardware">Curator: Synching
                hardware and environmental
                inertia...</span>
            <span class="font-technical" data-i18n="energy_v_status">v1.8 // PROFESSIONAL MIDEA SPECS // POLISHED</span>
        </footer>
    </main>

    <script type="module">
        import { StateManager } from './state-manager.js';
        import { TRANSLATIONS } from './i18n.js';

        const moduleSlider = document.getElementById('module-slider');
        const moduleVal = document.getElementById('module-val');
        const capacityVal = document.getElementById('capacity-val');
        const tierBtns = document.querySelectorAll('.tier-btn');
        const thermalBtns = document.querySelectorAll('.thermal-btn');
        const fingerprintDisplay = document.getElementById('fingerprint-display');
        const saveBtn = document.getElementById('save-btn');
        const statusText = document.getElementById('status-text');

        const specInverter = document.getElementById('spec-inverter');
        const specPv = document.getElementById('spec-pv');
        const specHp = document.getElementById('spec-hp');
        const specBatt = document.getElementById('spec-batt');

        const tankSlider = document.getElementById('tank-slider');
        const tankVal = document.getElementById('tank-val');
        const dhwTargetSlider = document.getElementById('dhw-target-slider');
        const dhwTargetVal = document.getElementById('dhw-target-val');

        const lang = localStorage.getItem('tasman-lang') || 'en';
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (TRANSLATIONS[lang][key]) {
                if (el.tagName === 'TITLE') {
                    document.title = TRANSLATIONS[lang][key];
                } else {
                    el.textContent = TRANSLATIONS[lang][key];
                }
            }
        });

        const TIER_DATA = {
            "ARCTIC_12": { name: "Arctic 12kW", inverter: "8.0 kW (MHELIOS ME-HS8L)", pv: "10 kW Max", hp: "12.1kW Therm // 4.2kW Elec", modules: 3, tank: 190 },
            "ARCTIC_14": { name: "Arctic 14kW", inverter: "10.0 kW (MHELIOS M1-T10K)", pv: "15 kW Max", hp: "14.5kW Therm // 5.5kW Elec", modules: 4, tank: 240 }
        };

        const state = StateManager.get().energy;
        let pendingState = { ...state };

        const updateUI = (s) => {
            if (!s) return;
            moduleSlider.value = s.battery_modules || 3;
            moduleVal.textContent = s.battery_modules || 3;
            capacityVal.textContent = `${((s.battery_modules || 3) * 5.12).toFixed(1)} kWh`;
            fingerprintDisplay.textContent = (s.fingerprint_val || 0.82).toFixed(2);

            const tier = s.midea_tier || "ARCTIC_12";
            const spec = TIER_DATA[tier] || TIER_DATA["ARCTIC_12"];

            specInverter.textContent = spec.inverter;
            specPv.textContent = spec.pv;
            specHp.textContent = spec.hp;
            specBatt.textContent = TRANSLATIONS[lang].h1_blocks.replace('{n}', spec.modules);

            tankSlider.value = s.dhw_tank_volume || spec.tank;
            tankVal.textContent = `${s.dhw_tank_volume || spec.tank}L`;
            dhwTargetSlider.value = s.dhw_target || 55;
            dhwTargetVal.textContent = `${s.dhw_target || 55}°C`;

            tierBtns.forEach(btn => {
                const isActive = btn.dataset.tier === tier;
                btn.classList.toggle('border-yellow-500', isActive);
                btn.classList.toggle('bg-yellow-900/20', isActive);
                const textEl = btn.querySelector('.text-xs');
                if (textEl) {
                    textEl.classList.toggle('text-yellow-500', isActive);
                    textEl.classList.toggle('text-slate-400', !isActive);
                }
            });

            thermalBtns.forEach(btn => {
                const isActive = btn.dataset.type === s.thermal_type;
                btn.classList.toggle('border-cyan-500', isActive);
                if (btn.dataset.type !== 'AI_FINGERPRINT') {
                    btn.classList.toggle('bg-cyan-900/10', isActive);
                }
            });
        };

        updateUI(state);

        moduleSlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            moduleVal.textContent = val;
            capacityVal.textContent = `${(val * 5.12).toFixed(1)} kWh`;
            pendingState.battery_modules = val;
            markUnsaved();
        });

        tankSlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            tankVal.textContent = `${val}L`;
            pendingState.dhw_tank_volume = val;
            markUnsaved();
        });

        dhwTargetSlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            dhwTargetVal.textContent = `${val}°C`;
            pendingState.dhw_target = val;
            markUnsaved();
        });

        tierBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tier = btn.dataset.tier;
                pendingState.midea_tier = tier;
                pendingState.battery_modules = TIER_DATA[tier].modules;
                updateUI(pendingState);
                markUnsaved();
            });
        });

        thermalBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const type = btn.dataset.type;
                const coeff = type === 'AI_FINGERPRINT' ? state.fingerprint_val : parseFloat(btn.dataset.val);
                pendingState.thermal_type = type;
                pendingState.thermal_coefficient = coeff;
                updateUI(pendingState);
                markUnsaved();
            });
        });

        function markUnsaved() {
            saveBtn.classList.add('animate-pulse', 'border-yellow-400', 'shadow-[0_0_20px_rgba(234,179,8,0.3)]');
            statusText.textContent = TRANSLATIONS[lang].tuning_mode;
        }

        saveBtn.addEventListener('click', () => {
            StateManager.set('energy', pendingState);
            saveBtn.classList.remove('animate-pulse', 'border-yellow-400', 'shadow-[0_0_20px_rgba(234,179,8,0.3)]');
            saveBtn.textContent = TRANSLATIONS[lang].changes_saved;
            statusText.textContent = TRANSLATIONS[lang].architecture_committed;
            setTimeout(() => {
                saveBtn.textContent = TRANSLATIONS[lang].save_btn;
            }, 2000);
        });
    </script>
</body>

</html>